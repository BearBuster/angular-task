<form (ngSubmit)="submit()" [formGroup]="form">
  <div class="w-100 mb-4 my-shadow container rounded pt-3">
    <h3>Dettagli gruppo di firma</h3>
    <div class="row pb-3">
      <div class="col-10">
        <label class="col-4 text-secondary m-2">
          Nome gruppo
          <app-my-input type="text" formControlName="groupName" />
        </label>

        <label class="col text-secondary m-2">
          Soglia minima servizi
          <div class="my-form-control d-flex">
            <app-my-input type="number" formControlName="maxValue" [subText]="{text: 'EURO', pos: 'after'}" />
          </div>
        </label>

        <label class="col text-secondary m-2">
          Soglia massima servizi
          <div class="my-form-control d-flex">
            <app-my-input type="number" formControlName="minValue" [subText]="{text: 'EURO', pos: 'after'}" />
          </div>
        </label>
      </div>

      <div class="col d-flex justify-content-end opacity-50 m-2" style="padding-top: 17px">

        <ng-container
          *ngFor="let user of users.controls; let i=index"
          formArrayName="users"
        >
          <div class="circle"
            [formGroupName]="i"
            *ngIf="user.value.checked"
          >
            <p class="circle-inner">{{user.value.userInitials}}</p>
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-between mb-3">
    <div class="function-list-container my-shadow rounded">
      <h3>
        Abilita servizi per gruppo di firma
        <h5 class="text-secondary">Seleziona i servizi e imposta la relativa soglia</h5>
      </h3>

      <table style="width: 100%">
        <div style="height: 590px; overflow-y: scroll; padding-right: 20px">
        <thead>
          <tr>
            <th>Servizio</th>
            <th>Soglia minima</th>
            <th>Soglia massima</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let fun of functions.controls; let i = index"
            formArrayName="functions"
            class="row-height"
          >
            <ng-container [formGroupName]="i">
              <td>
                <app-toggle-slider formControlName="checked" #toggle />
                <span style="margin-left: 10px" title="{{fun.value.name}}">{{ fun.value.name | characters: 20 }}</span>
              </td>
              <td>
                <app-my-input type="number" formControlName="minValue" [subText]="{text: 'EURO', pos: 'after'}" [isDisabled]="!toggle.toggleOn" />
              </td>
              <td>
                <app-my-input type="number" formControlName="maxValue" [subText]="{text: 'EURO', pos: 'after'}" [isDisabled]="!toggle.toggleOn" />
              </td>
            </ng-container>
          </tr>
        </tbody>
        </div>
      </table>
    </div>
    <div class="user-list-container my-shadow rounded">
      <h3>
        Seleziona utenti da aggiungere al gruppo
        <h5 class="text-secondary">Sono disponibili solo gli utenti dispositivi</h5>
      </h3>
      <div class="col-4">
        <app-my-input [formControl]="filterPlace" placeholder="Filtra..."/>
      </div>
      <ul style="list-style: none; padding: 0; margin-top: 10px">
        <ng-container
          *ngFor="let user of usersArr$ | async;let i=index"
          formArrayName="users"
        >
          <li class="my-2" [formGroupName]="i">
            <app-user-checkbox formControlName="checked" [fullName]="user.value.fullName" [initial]="user.value.userInitials" />
          </li>
        </ng-container>
      </ul>
    </div>
  </div>
  <div class="w-100" style="display: flex; justify-content: end">
    <button class="btn" (click)="router.navigate([''])">Indietro</button>
    <button class="btn btn-primary" type="submit">Modifica</button>
  </div>
</form>
<pre>{{form.value | json}}</pre>
